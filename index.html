<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Criptomoedas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-coins"></i> Dashboard de Criptomoedas</h1>
            <p class="subtitle">Cota√ß√µes em tempo real</p>
        </header>

        <div class="controls">
            <button id="fetchDataButton" class="btn btn-primary">
                <i class="fas fa-sync"></i> Atualizar Cota√ß√µes
            </button>
            <span id="lastUpdate" class="last-update"></span>
        </div>

        <div class="loading" id="loading" style="display:none;">
            <i class="fas fa-spinner fa-spin"></i> Carregando dados...
        </div>

        <div id="result" class="crypto-grid"></div>

        <footer class="footer">
            <p>Dados fornecidos pela API CoinGecko | Atualizado automaticamente a cada 60 segundos</p>
        </footer>
    </div>

    <script>
        // Mapeamento de √≠cones de criptos
        const cryptoIcons = {
            'bitcoin': 'fab fa-bitcoin',
            'ethereum': 'fab fa-ethereum',
            'litecoin': 'fab fa-btc',
            'ripple': 'fas fa-x',
            'cardano': 'fas fa-coins',
            'solana': 'fas fa-coins',
            'dogecoin': 'fab fa-doge',
            'polkadot': 'fas fa-circle',
            'avalanche': 'fas fa-mountain',
            'uniswap': 'fas fa-swap'
        };

        function getIcon(name) {
            const lower = name.toLowerCase();
            return cryptoIcons[lower] || 'fas fa-coins';
        }

        function formatPrice(price) {
            if (price === 0 || !price) return 'N/A';
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(price);
        }

        function formatCompactPrice(price) {
            if (price === 0 || !price) return 'N/A';
            if (price >= 1000000000) {
                return 'R$ ' + (price / 1000000000).toFixed(2) + 'B';
            } else if (price >= 1000000) {
                return 'R$ ' + (price / 1000000).toFixed(2) + 'M';
            } else if (price >= 1000) {
                return 'R$ ' + (price / 1000).toFixed(2) + 'K';
            }
            return formatPrice(price);
        }

        function getTrendingStatus(change) {
            if (change > 5) return { icon: 'üìà', class: 'trending-up', text: 'Em alta' };
            if (change > 0) return { icon: '‚ÜóÔ∏è', class: 'trending-stable', text: 'Est√°vel' };
            if (change > -5) return { icon: '‚ÜòÔ∏è', class: 'trending-stable', text: 'Est√°vel' };
            return { icon: 'üìâ', class: 'trending-down', text: 'Em queda' };
        }

        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `‚è∞ ${now.toLocaleTimeString('pt-BR')}`;
        }

        function fetchCryptoData() {
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            
            loading.style.display = 'flex';
            result.innerHTML = '';

            // URL da API CoinGecko (chamada direta do navegador)
            const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=brl&order=market_cap_desc&per_page=10&page=1&sparkline=false&locale=pt';

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!Array.isArray(data) || data.length === 0) {
                        throw new Error('Dados inv√°lidos recebidos da API');
                    }

                    let output = '';
                    
                    data.forEach((crypto, index) => {
                        const change24h = crypto.price_change_percentage_24h || 0;
                        const icon = getIcon(crypto.name);
                        const trending = getTrendingStatus(change24h);
                        const priceChange = (crypto.high_24h || 0) - (crypto.low_24h || 0);
                        const priceChangePercent = (crypto.high_24h || 0) > 0 ? 
                            ((priceChange / (crypto.low_24h || 1)) * 100).toFixed(2) : 0;
                        
                        output += `
                            <div class="crypto-card">
                                <!-- HEADER -->
                                <div class="crypto-header">
                                    <div class="rank-badge">#${crypto.market_cap_rank || index + 1}</div>
                                    <div class="crypto-name-section">
                                        <div class="crypto-icon-name">
                                            <i class="${icon}"></i>
                                            <div>
                                                <h3>${crypto.name}</h3>
                                                <span class="symbol">${crypto.symbol.toUpperCase()}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="trending-badge ${trending.class}">
                                        ${trending.icon} ${trending.text}
                                    </div>
                                </div>

                                <!-- PRE√áO PRINCIPAL -->
                                <div class="price-main">
                                    <div class="current-price">${formatPrice(crypto.current_price)}</div>
                                    <div class="price-change ${change24h >= 0 ? 'positive' : 'negative'}">
                                        <span class="icon">${change24h >= 0 ? '‚ñ≤' : '‚ñº'}</span>
                                        <span class="value">${Math.abs(change24h).toFixed(2)}%</span>
                                    </div>
                                </div>

                                <!-- RANGE 24H -->
                                <div class="price-range">
                                    <div class="range-label">Varia√ß√£o 24h</div>
                                    <div class="range-bar">
                                        <div class="range-info">
                                            <small>Min: ${formatPrice(crypto.low_24h)}</small>
                                            <small>Max: ${formatPrice(crypto.high_24h)}</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- DETALHES -->
                                <div class="crypto-details">
                                    <div class="detail-row">
                                        <div class="detail-item">
                                            <span class="detail-icon">üí∞</span>
                                            <span class="detail-label">Market Cap</span>
                                            <span class="detail-value">${formatCompactPrice(crypto.market_cap)}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-icon">üìä</span>
                                            <span class="detail-label">Volume 24h</span>
                                            <span class="detail-value">${formatCompactPrice(crypto.total_volume)}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="detail-row">
                                        <div class="detail-item">
                                            <span class="detail-icon">üîÑ</span>
                                            <span class="detail-label">Supply</span>
                                            <span class="detail-value">${crypto.circulating_supply ? crypto.circulating_supply.toFixed(0) : 'N/A'}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-icon">üìà</span>
                                            <span class="detail-label">Range 24h</span>
                                            <span class="detail-value">${priceChangePercent}%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- FOOTER -->
                                <div class="crypto-footer">
                                    <small>Atualizado: ${new Date(crypto.last_updated).toLocaleTimeString('pt-BR')}</small>
                                </div>
                            </div>
                        `;
                    });

                    result.innerHTML = output;
                    updateLastUpdate();
                })
                .catch(error => {
                    console.error('Erro:', error);
                    result.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>‚ùå Erro ao obter dados</p>
                            <p style="font-size: 12px; color: #666;">${error.message}</p>
                            <p style="font-size: 11px; color: #999; margin-top: 15px;">üí° Verifique sua conex√£o com a internet<br>Recarregue a p√°gina para tentar novamente</p>
                        </div>
                    `;
                })
                .finally(() => {
                    loading.style.display = 'none';
                });
        }

        // Event listeners
        document.getElementById('fetchDataButton').addEventListener('click', fetchCryptoData);

        // Carregar dados ao abrir a p√°gina
        window.addEventListener('load', fetchCryptoData);

        // Auto-atualizar a cada 60 segundos
        setInterval(fetchCryptoData, 60000);
    </script>
</body>
</html>
